<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>System Architecture Diagram</title>
    <!-- Mermaid.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            background-color: white;
        }

        .mermaid {
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <h1>System Architecture & Data Flow</h1>
    <div class="mermaid">
        sequenceDiagram
        autonumber
        participant User as ğŸ‘¤ ì‚¬ìš©ì (Browser)
        participant Django as ğŸŸ¢ Django Server (Uvicorn)
        participant Redis as ğŸ”´ Redis (Channel Layer)
        participant KIS as ğŸ¦ í•œêµ­íˆ¬ìì¦ê¶Œ (KIS API)

        Note over User, Django: 1. ì´ˆê¸° ì›¹í˜ì´ì§€ ì ‘ì† (HTTP)
        User->>Django: GET /api/stock/
        Django->>User: HTML ì‘ë‹µ (stock_realtime.html)

        Note over User, KIS: 2. ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²° (WebSocket)
        User->>Django: WebSocket ì—°ê²° ìš”ì²­ (ws://.../ws/stock/)
        Django->>Redis: ì±„ë„ ë ˆì´ì–´ ì—°ê²° í™•ì¸
        Django-->>User: ì—°ê²° ìˆ˜ë½ (Handshake)

        Note over Django, KIS: 3. ì™¸ë¶€ ì¦ê¶Œì‚¬ ì„œë²„ ì—°ê²° (Proxy)
        Django->>KIS: WebSocket ì—°ê²° ìš”ì²­
        KIS-->>Django: ì—°ê²° ìˆ˜ë½
        Django->>KIS: ì‹¤ì‹œê°„ ë°ì´í„° êµ¬ë… ìš”ì²­ (ì¢…ëª©ì½”ë“œ: ì‚¼ì„±ì „ì)

        Note over User, KIS: 4. ì‹¤ì‹œê°„ ë°ì´í„° ì¤‘ê³„ (Loop)
        loop ì‹¤ì‹œê°„ ì£¼ê°€ ìˆ˜ì‹ 
        KIS->>Django: ì£¼ê°€ ë°ì´í„° ì „ì†¡ (JSON)
        Django->>Django: ë°ì´í„° ì²˜ë¦¬ (consumers.py)
        Django->>User: ë°ì´í„° ì „ë‹¬ (self.send)
        User->>User: í™”ë©´ ì—…ë°ì´íŠ¸ (JS)
        end
    </div>
</body>

</html>